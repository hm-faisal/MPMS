openapi: 3.0.3
info:
  title: Minimal Project Management System (MPMS) API
  description: |
    API documentation for the Minimal Project Management System.

    ## Authentication
    Most endpoints require JWT authentication.

    ## Roles
    - **Admin**: Full system access
    - **Manager**: Project oversight and team management
    - **Member**: Task execution and updates
  version: 1.0.0
  contact:
    name: DATAPOLLEX LIMITED
    url: https://www.datapollex.com
    email: info@datapollex.com

servers:
  - url: http://localhost:8080/api/v1
    description: Development server api
  - url: http://localhost:8080
    description: Development server
  - url: https://api.mpms.example.com/api/v1
    description: Production server api
  - url: https://api.mpms.example.com
    description: Production server

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Users
    description: User management operations
  - name: Projects
    description: Project management operations
  - name: Sprints
    description: Sprint management operations
  - name: Tasks
    description: Task management operations
  - name: Comments
    description: Task comments and discussions
  - name: Reports
    description: Reporting and analytics
  - name: Search
    description: Global search functionality
  - name: Dashboard
    description: Dashboard statistics and widgets
  - name: Notifications
    description: User notifications and alerts

paths:
  # ==================== Authentication ====================
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account (Admin only)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - role
              properties:
                name:
                  type: string
                  maxLength: 255
                  example: "Jane Smith"
                email:
                  type: string
                  format: email
                  maxLength: 255
                  example: "jane.smith@example.com"
                password:
                  type: string
                  format: password
                  maxLength: 255
                  example: "SecurePass123!"
                role:
                  type: string
                  enum: [Admin, Manager, Member]
                  example: "Member"
                department:
                  type: string
                  maxLength: 255
                  example: "Engineering"
                skills:
                  type: array
                  items:
                    type: string
                    maxLength: 255
                  example: ["Python", "Django"]
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 201
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "User created successfully"
                  data:
                    $ref: "#/components/schemas/User"
                  links:
                    type: object
                    properties:
                      self:
                        type: string
                        example: "/api/users/"
                      dashboard:
                        type: string
                        example: "/api/dashboard/"

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "john.doe@example.com"
                password:
                  type: string
                  format: password
                  example: "SecurePass123!"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/User"
                  links:
                    type: object
                    properties:
                      self:
                        type: string
                        example: "/api/login/"
                      dashboard:
                        type: string
                        example: "/api/dashboard/"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      security:
        - CookieAuth: []
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh JWT token
      security:
        - CookieAuth: []
      responses:
        "200":
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        "200":
          description: Password reset email sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                newPassword:
                  type: string
                  format: password
      responses:
        "200":
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Comments ====================
  /comments/{id}:
    put:
      tags:
        - Comments
      summary: Update comment
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
      responses:
        "200":
          description: Comment updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Comment"

    delete:
      tags:
        - Comments
      summary: Delete comment
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Comment deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Reports ====================
  /reports/project/{projectId}:
    get:
      tags:
        - Reports
      summary: Get project report
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project report retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      project:
                        $ref: "#/components/schemas/Project"
                      totalTasks:
                        type: integer
                      completedTasks:
                        type: integer
                      tasksInProgress:
                        type: integer
                      tasksInReview:
                        type: integer
                      todoTasks:
                        type: integer
                      completionPercentage:
                        type: number
                      totalTimeLogged:
                        type: number
                      totalEstimatedTime:
                        type: number
                      tasksByPriority:
                        type: object
                        properties:
                          Low:
                            type: integer
                          Medium:
                            type: integer
                          High:
                            type: integer
                          Critical:
                            type: integer
                      sprintProgress:
                        type: array
                        items:
                          type: object
                          properties:
                            sprintId:
                              type: string
                            sprintTitle:
                              type: string
                            completionPercentage:
                              type: number

  /reports/user/{userId}:
    get:
      tags:
        - Reports
      summary: Get user report
      security:
        - CookieAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        "200":
          description: User report retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: "#/components/schemas/User"
                      assignedTasks:
                        type: integer
                      completedTasks:
                        type: integer
                      inProgressTasks:
                        type: integer
                      totalTimeLogged:
                        type: number
                      tasksCompletedOnTime:
                        type: integer
                      overdueTasksCompleted:
                        type: integer
                      currentOverdueTasks:
                        type: integer
                      projectsInvolved:
                        type: array
                        items:
                          type: object
                          properties:
                            projectId:
                              type: string
                            projectTitle:
                              type: string
                            tasksAssigned:
                              type: integer
                            tasksCompleted:
                              type: integer

  /reports/overview:
    get:
      tags:
        - Reports
      summary: Get system overview report
      description: Get overall system statistics (Admin only)
      security:
        - CookieAuth: []
      responses:
        "200":
          description: System overview retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      totalProjects:
                        type: integer
                      activeProjects:
                        type: integer
                      completedProjects:
                        type: integer
                      totalUsers:
                        type: integer
                      activeUsers:
                        type: integer
                      totalTasks:
                        type: integer
                      completedTasks:
                        type: integer
                      totalTimeLogged:
                        type: number
                      projectsByStatus:
                        type: object
                      tasksByStatus:
                        type: object
                      recentActivity:
                        type: array
                        items:
                          $ref: "#/components/schemas/ActivityLog"

  # ==================== Activity Logs ====================
  /tasks/{taskId}/activity:
    get:
      tags:
        - Tasks
      summary: Get activity log for a task
      security:
        - CookieAuth: []
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Activity log retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ActivityLog"

  /projects/{projectId}/activity:
    get:
      tags:
        - Projects
      summary: Get activity log for a project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Activity log retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/ActivityLog"

  # ==================== User Profile ====================
  /users/profile:
    get:
      tags:
        - Users
      summary: Get current user profile
      security:
        - CookieAuth: []
      responses:
        "200":
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"

    patch:
      tags:
        - Users
      summary: Update current user profile
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                department:
                  type: string
                skills:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Profile updated successfully

  /users/change-password:
    post:
      tags:
        - Users
      summary: Change current user password
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
      responses:
        "200":
          description: Password changed successfully

  # ==================== Project Team Management ====================
  /projects/{projectId}/members:
    get:
      tags:
        - Projects
      summary: Get project team members
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Team members retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"

    post:
      tags:
        - Projects
      summary: Add members to project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userIds
              properties:
                userIds:
                  type: array
                  items:
                    type: string
                  example:
                    ["507f1f77bcf86cd799439011", "507f1f77bcf86cd799439012"]
      responses:
        "200":
          description: Members added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /projects/{projectId}/members/{userId}:
    delete:
      tags:
        - Projects
      summary: Remove member from project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Member removed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Task Assignment ====================
  /tasks/{taskId}/assign:
    post:
      tags:
        - Tasks
      summary: Assign users to task
      security:
        - CookieAuth: []
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userIds
              properties:
                userIds:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Users assigned successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"

  /tasks/{taskId}/unassign:
    post:
      tags:
        - Tasks
      summary: Unassign users from task
      security:
        - CookieAuth: []
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userIds
              properties:
                userIds:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Users unassigned successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"

  # ==================== Attachments ====================
  /attachments/{filename}:
    get:
      tags:
        - Tasks
      summary: Download attachment
      security:
        - CookieAuth: []
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: File downloaded successfully
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /tasks/{taskId}/attachments/{attachmentId}:
    delete:
      tags:
        - Tasks
      summary: Delete attachment
      security:
        - CookieAuth: []
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
        - name: attachmentId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Attachment deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Search ====================
  /search:
    get:
      tags:
        - Search
      summary: Global search across projects, tasks, and users
      security:
        - CookieAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
        - name: type
          in: query
          schema:
            type: string
            enum: [all, projects, tasks, users]
            default: all
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Search results retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      projects:
                        type: array
                        items:
                          $ref: "#/components/schemas/Project"
                      tasks:
                        type: array
                        items:
                          $ref: "#/components/schemas/Task"
                      users:
                        type: array
                        items:
                          $ref: "#/components/schemas/User"

  # ==================== Dashboard Analytics ====================
  /dashboard/stats:
    get:
      tags:
        - Dashboard
      summary: Get dashboard statistics for current user
      security:
        - CookieAuth: []
      responses:
        "200":
          description: Dashboard statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      myTasks:
                        type: object
                        properties:
                          total:
                            type: integer
                          todo:
                            type: integer
                          inProgress:
                            type: integer
                          review:
                            type: integer
                          done:
                            type: integer
                      myProjects:
                        type: integer
                      upcomingDeadlines:
                        type: array
                        items:
                          type: object
                          properties:
                            taskId:
                              type: string
                            title:
                              type: string
                            dueDate:
                              type: string
                              format: date
                            daysRemaining:
                              type: integer
                      recentActivity:
                        type: array
                        items:
                          $ref: "#/components/schemas/ActivityLog"
                      timeLoggedThisWeek:
                        type: number

  # ==================== Batch Operations ====================
  /tasks/batch/update:
    put:
      tags:
        - Tasks
      summary: Batch update tasks
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - taskIds
                - updates
              properties:
                taskIds:
                  type: array
                  items:
                    type: string
                updates:
                  type: object
                  properties:
                    status:
                      type: string
                    priority:
                      type: string
                    assignees:
                      type: array
                      items:
                        type: string
      responses:
        "200":
          description: Tasks updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      updatedCount:
                        type: integer
                      failedCount:
                        type: integer

  /tasks/batch/delete:
    delete:
      tags:
        - Tasks
      summary: Batch delete tasks
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - taskIds
              properties:
                taskIds:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Tasks deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Export ====================
  /reports/export/project/{projectId}:
    get:
      tags:
        - Reports
      summary: Export project report
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
        - name: format
          in: query
          schema:
            type: string
            enum: [pdf, csv, excel]
            default: pdf
      responses:
        "200":
          description: Report exported successfully
          content:
            application/pdf:
              schema:
                type: string
                format: binary
            text/csv:
              schema:
                type: string
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

  /reports/export/tasks:
    get:
      tags:
        - Reports
      summary: Export tasks report
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
        - name: sprintId
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
        - name: format
          in: query
          schema:
            type: string
            enum: [csv, excel]
            default: csv
      responses:
        "200":
          description: Tasks exported successfully
          content:
            text/csv:
              schema:
                type: string
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

  # ==================== Sprint Statistics ====================
  /sprints/{id}/stats:
    get:
      tags:
        - Sprints
      summary: Get sprint statistics
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprint statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sprint:
                        $ref: "#/components/schemas/Sprint"
                      totalTasks:
                        type: integer
                      completedTasks:
                        type: integer
                      completionPercentage:
                        type: number
                      totalTimeLogged:
                        type: number
                      totalEstimatedTime:
                        type: number
                      daysRemaining:
                        type: integer
                      velocity:
                        type: number
                        description: Tasks completed per day
                      burndownData:
                        type: array
                        items:
                          type: object
                          properties:
                            date:
                              type: string
                              format: date
                            remainingTasks:
                              type: integer

  # ==================== Notifications (Optional) ====================
  /notifications:
    get:
      tags:
        - Notifications
      summary: Get user notifications
      security:
        - CookieAuth: []
      parameters:
        - name: unreadOnly
          in: query
          schema:
            type: boolean
            default: false
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Notifications retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                        type:
                          type: string
                          enum:
                            [
                              task_assigned,
                              task_updated,
                              comment_added,
                              status_changed,
                              mention,
                            ]
                        message:
                          type: string
                        relatedId:
                          type: string
                        isRead:
                          type: boolean
                        createdAt:
                          type: string
                          format: date-time

  /notifications/{id}/read:
    patch:
      tags:
        - Notifications
      summary: Mark notification as read
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Notification marked as read
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /notifications/read-all:
    patch:
      tags:
        - Notifications
      summary: Mark all notifications as read
      security:
        - CookieAuth: []
      responses:
        "200":
          description: All notifications marked as read
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/User"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Admin access required

  # ==================== Users ====================
  /users:
    get:
      tags:
        - Users
      summary: Get all users
      description: Retrieve list of all users (Admin only)
      security:
        - CookieAuth: []
      parameters:
        - name: role
          in: query
          schema:
            type: string
            enum: [Admin, Manager, Member]
        - name: department
          in: query
          schema:
            type: string
        - name: isActive
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"
        "404":
          description: User not found

    put:
      tags:
        - Users
      summary: Update user
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: [Admin, Manager, Member]
                department:
                  type: string
                skills:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"

    delete:
      tags:
        - Users
      summary: Deactivate user
      description: Deactivate user account (Admin only)
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User deactivated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Projects ====================
  /projects:
    get:
      tags:
        - Projects
      summary: Get all projects
      security:
        - CookieAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [planned, active, completed, archived]
        - name: client
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Project"
                  pagination:
                    $ref: "#/components/schemas/Pagination"

    post:
      tags:
        - Projects
      summary: Create new project
      description: Create a new project (Admin/Manager only)
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - client
                - startDate
                - endDate
              properties:
                title:
                  type: string
                  example: "Mobile App Development"
                client:
                  type: string
                  example: "Tech Startup Inc"
                description:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                budget:
                  type: number
                status:
                  type: string
                  enum: [planned, active, completed, archived]
                  default: planned
                thumbnail:
                  type: string
      responses:
        "201":
          description: Project created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"

  /projects/{id}:
    get:
      tags:
        - Projects
      summary: Get project by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"
        "404":
          description: Project not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    put:
      tags:
        - Projects
      summary: Update project
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                client:
                  type: string
                description:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                budget:
                  type: number
                status:
                  type: string
                  enum: [planned, active, completed, archived]
                thumbnail:
                  type: string
      responses:
        "200":
          description: Project updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"

    delete:
      tags:
        - Projects
      summary: Delete project
      description: Delete project (Admin only)
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /projects/{id}/stats:
    get:
      tags:
        - Projects
      summary: Get project statistics
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project statistics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      totalTasks:
                        type: integer
                      completedTasks:
                        type: integer
                      inProgressTasks:
                        type: integer
                      completionPercentage:
                        type: number
                      totalTimeLogged:
                        type: number
                      estimatedTimeRemaining:
                        type: number

  # ==================== Sprints ====================
  /projects/{projectId}/sprints:
    get:
      tags:
        - Sprints
      summary: Get all sprints for a project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprints retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Sprint"

    post:
      tags:
        - Sprints
      summary: Create new sprint
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - startDate
                - endDate
              properties:
                title:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
      responses:
        "201":
          description: Sprint created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Sprint"

  /sprints/{id}:
    get:
      tags:
        - Sprints
      summary: Get sprint by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprint retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Sprint"

    put:
      tags:
        - Sprints
      summary: Update sprint
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
      responses:
        "200":
          description: Sprint updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Sprint"

    delete:
      tags:
        - Sprints
      summary: Delete sprint
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprint deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /sprints/reorder:
    put:
      tags:
        - Sprints
      summary: Reorder sprints
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sprints
              properties:
                sprints:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                      order:
                        type: integer
      responses:
        "200":
          description: Sprints reordered successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Tasks ====================
  /tasks:
    get:
      tags:
        - Tasks
      summary: Get all tasks with filters
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
        - name: sprintId
          in: query
          schema:
            type: string
        - name: assignee
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [To Do, In Progress, Review, Done]
        - name: priority
          in: query
          schema:
            type: string
            enum: [Low, Medium, High, Critical]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Tasks retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Task"

  /sprints/{sprintId}/tasks:
    post:
      tags:
        - Tasks
      summary: Create new task
      security:
        - CookieAuth: []
      parameters:
        - name: sprintId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - assignees
                - priority
                - dueDate
              properties:
                title:
                  type: string
                description:
                  type: string
                assignees:
                  type: array
                  items:
                    type: string
                estimate:
                  type: number
                priority:
                  type: string
                  enum: [Low, Medium, High, Critical]
                status:
                  type: string
                  enum: [To Do, In Progress, Review, Done]
                  default: To Do
                dueDate:
                  type: string
                  format: date
                subtasks:
                  type: array
                  items:
                    type: object
                    properties:
                      title:
                        type: string
                      completed:
                        type: boolean
      responses:
        "201":
          description: Task created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"

  /tasks/{id}:
    get:
      tags:
        - Tasks
      summary: Get task by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Task retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"

    put:
      tags:
        - Tasks
      summary: Update task
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                assignees:
                  type: array
                  items:
                    type: string
                estimate:
                  type: number
                priority:
                  type: string
                  enum: [Low, Medium, High, Critical]
                status:
                  type: string
                  enum: [To Do, In Progress, Review, Done]
                dueDate:
                  type: string
                  format: date
      responses:
        "200":
          description: Task updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"

    delete:
      tags:
        - Tasks
      summary: Delete task
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Task deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /tasks/{id}/status:
    patch:
      tags:
        - Tasks
      summary: Update task status
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [To Do, In Progress, Review, Done]
      responses:
        "200":
          description: Task status updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"

  /tasks/{id}/time-log:
    post:
      tags:
        - Tasks
      summary: Log time on task
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - hours
              properties:
                hours:
                  type: number
                  example: 2.5
                description:
                  type: string
                  example: "Implemented authentication logic"
      responses:
        "200":
          description: Time logged successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"

  /tasks/{id}/attachments:
    post:
      tags:
        - Tasks
      summary: Upload attachment to task
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: Attachment uploaded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Attachment"

  # ==================== Comments ====================
  /tasks/{taskId}/comments:
    get:
      tags:
        - Comments
      summary: Get all comments for a task
      security:
        - CookieAuth: []
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Comments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Comment"

    post:
      tags:
        - Comments
      summary: Add comment to task
      security:
        - CookieAuth: []
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  example: "This looks good, but we need to add error handling"
                parentCommentId:
                  type: string
                  nullable: true
      responses:
        "201":
          description: Comment added successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"

components:
  securitySchemes:
    CookieAuth:
      type: apiKey
      in: cookie
      name: session_id

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        role:
          type: string
          enum: [Admin, Manager, Member]
          example: "Member"
        department:
          type: string
          example: "Engineering"
        skills:
          type: array
          items:
            type: string
          example: ["JavaScript", "React", "Node.js"]
        status:
          type: string
          enum: [Active, Inactive, Blocked]
          example: "Active"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Project:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        title:
          type: string
          example: "E-Commerce Platform"
        client:
          type: string
          example: "Acme Corporation"
        description:
          type: string
          example: "Building a modern e-commerce platform with microservices"
        startDate:
          type: string
          format: date
          example: "2025-01-01"
        endDate:
          type: string
          format: date
          example: "2025-06-30"
        budget:
          type: number
          example: 50000
        status:
          type: string
          enum: [planned, active, completed, archived]
          example: "active"
        thumbnail:
          type: string
          example: "https://example.com/images/project-thumb.jpg"
        createdBy:
          type: string
          example: "507f1f77bcf86cd799439011"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Sprint:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        title:
          type: string
          example: "Sprint 1 - Foundation"
        sprintNumber:
          type: integer
          example: 1
        startDate:
          type: string
          format: date
          example: "2025-01-01"
        endDate:
          type: string
          format: date
          example: "2025-01-14"
        projectId:
          type: string
          example: "507f1f77bcf86cd799439011"
        order:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Task:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        title:
          type: string
          example: "Implement user authentication"
        description:
          type: string
          example: "Set up JWT-based authentication with refresh tokens"
        assignees:
          type: array
          items:
            type: string
          example: ["507f1f77bcf86cd799439011"]
        estimate:
          type: number
          example: 8
        priority:
          type: string
          enum: [Low, Medium, High, Critical]
          example: "High"
        status:
          type: string
          enum: [To Do, In Progress, Review, Done]
          example: "In Progress"
        dueDate:
          type: string
          format: date
          example: "2025-01-10"
        attachments:
          type: array
          items:
            $ref: "#/components/schemas/Attachment"
        subtasks:
          type: array
          items:
            $ref: "#/components/schemas/Subtask"
        sprintId:
          type: string
          example: "507f1f77bcf86cd799439011"
        projectId:
          type: string
          example: "507f1f77bcf86cd799439011"
        timeLogged:
          type: number
          example: 5.5
        createdBy:
          type: string
          example: "507f1f77bcf86cd799439011"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Attachment:
      type: object
      properties:
        filename:
          type: string
          example: "design-mockup.pdf"
        url:
          type: string
          example: "https://storage.example.com/files/design-mockup.pdf"
        uploadedBy:
          type: string
          example: "507f1f77bcf86cd799439011"
        uploadedAt:
          type: string
          format: date-time

    Subtask:
      type: object
      properties:
        title:
          type: string
          example: "Set up JWT library"
        completed:
          type: boolean
          example: false

    Comment:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        content:
          type: string
          example: "I've completed the initial setup. Ready for review."
        taskId:
          type: string
          example: "507f1f77bcf86cd799439011"
        userId:
          type: string
          example: "507f1f77bcf86cd799439011"
        parentCommentId:
          type: string
          nullable: true
          example: null
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ActivityLog:
      type: object
      properties:
        _id:
          type: string
        taskId:
          type: string
        userId:
          type: string
        action:
          type: string
          example: "status_changed"
        details:
          type: object
          example: { "from": "To Do", "to": "In Progress" }
        timestamp:
          type: string
          format: date-time

    Error:
      type: object
      properties:
        code:
          type: integer
          example: 400
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Error happened"
        error:
          type: object
          properties:
            code:
              type: string
              example: "VALIDATION_ERROR"
            message:
              type: string
              example: "Invalid input data"
            details:
              type: object

    Success:
      type: object
      properties:
        code:
          type: integer
          example: 200
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"
        links:
          type: object
          properties:
            self:
              type: string
              example: "/api/v1/resource"

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 10
        total:
          type: integer
          example: 100
