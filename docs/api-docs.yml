openapi: 3.0.3
info:
  title: Minimal Project Management System (MPMS) API
  description: |
    API documentation for the Minimal Project Management System.

    ## Authentication
    Most endpoints require JWT authentication.

    ## Roles
    - **Admin**: Full system access
    - **Manager**: Project oversight and team management
    - **Member**: Task execution and updates
  version: 1.0.0
  contact:
    name: DATAPOLLEX LIMITED
    url: https://www.datapollex.com
    email: info@datapollex.com

servers:
  - url: http://localhost:8080/api/v1
    description: Development server api
  - url: http://localhost:8080
    description: Development server
  - url: https://mpms-cv4d.onrender.com/api/v1
    description: Production server api
  - url: https://mpms-cv4d.onrender.com
    description: Production server

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Users
    description: User management operations
  - name: Projects
    description: Project management operations
  - name: Sprints
    description: Sprint management operations
  - name: Tasks
    description: Task management operations

paths:
  # ==================== Authentication ====================
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account (Admin only)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
                - role
              properties:
                name:
                  type: string
                  maxLength: 255
                  example: "Jane Smith"
                email:
                  type: string
                  format: email
                  maxLength: 255
                  example: "jane.smith@example.com"
                password:
                  type: string
                  format: password
                  maxLength: 255
                  example: "SecurePass123!"
                role:
                  type: string
                  enum: [Admin, Manager, Member]
                  example: "Member"
                department:
                  type: string
                  maxLength: 255
                  example: "Engineering"
                skills:
                  type: array
                  items:
                    type: string
                    maxLength: 255
                  example: ["Python", "Django"]
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 201
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "User created successfully"
                  data:
                    $ref: "#/components/schemas/User"
                  links:
                    type: object
                    properties:
                      self:
                        type: string
                        example: "/api/users/"
                      dashboard:
                        type: string
                        example: "/api/dashboard/"
        "400":
          $ref: "#/components/responses/400"

        "500":
          $ref: "#/components/responses/500"

  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "john.doe@example.com"
                password:
                  type: string
                  format: password
                  example: "SecurePass123!"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: "#/components/schemas/User"
                  links:
                    type: object
                    properties:
                      self:
                        type: string
                        example: "/api/login/"
                      dashboard:
                        type: string
                        example: "/api/dashboard/"
        "500":
          $ref: "#/components/responses/500"

  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user profile
      security:
        - CookieAuth: []
      responses:
        "200":
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Clears authentication cookie and logs out user
      security:
        - CookieAuth: []
      responses:
        "204":
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 204
                  message:
                    type: string
                    example: "User logged out successfully"
                  data:
                    nullable: true
                    example: null
        "500":
          $ref: "#/components/responses/500"

  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset (Not Implemented Yet)
      description: >
        **Note**: This endpoint is defined in routes but not yet implemented.
        It will initiate the password reset process by sending a reset link to the user's email.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
      responses:
        "200":
          description: Password reset email sent (placeholder)
        "501":
          description: Not Implemented

  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password with token (Not Implemented Yet)
      description: >
        **Note**: This endpoint is defined in routes but not yet implemented.
        It will allow users to reset their password using a token received via email.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                  example: "reset-token-123"
                newPassword:
                  type: string
                  format: password
                  example: "NewSecurePass123!"
      responses:
        "200":
          description: Password reset successful (placeholder)
        "501":
          description: Not Implemented

  # ==================== User Profile ====================
  /users/profile:
    get:
      tags:
        - Users
      summary: Get current user profile
      security:
        - CookieAuth: []
      responses:
        "200":
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"

    patch:
      tags:
        - Users
      summary: Update current user profile
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                department:
                  type: string
                skills:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: Profile updated successfully

  /users/change-password:
    post:
      tags:
        - Users
      summary: Change current user password
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
                - confirmNewPassword
              properties:
                oldPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
                confirmNewPassword:
                  type: string
                  format: password
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"

  # ==================== Project Team Management ====================
  /projects/{projectId}/members:
    get:
      tags:
        - Projects
      summary: Get project team members
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Team members retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"

    post:
      tags:
        - Projects
      summary: Add members to project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userIds
              properties:
                userIds:
                  type: array
                  items:
                    type: string
                  example:
                    ["507f1f77bcf86cd799439011", "507f1f77bcf86cd799439012"]
      responses:
        "200":
          description: Members added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  /projects/{projectId}/members/{userId}:
    delete:
      tags:
        - Projects
      summary: Remove member from project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
        - name: userId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Member removed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"

  # ==================== Sprint Statistics ====================
  /sprints/{id}/stats:
    get:
      tags:
        - Sprints
      summary: Get sprint statistics (Partially Implemented)
      description: >
        **Note**: This endpoint exists in routes but returns an empty handler.
        Implementation is incomplete. It will return sprint statistics when fully implemented.
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprint statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sprint:
                        $ref: "#/components/schemas/Sprint"
                      totalTasks:
                        type: integer
                      completedTasks:
                        type: integer
                      completionPercentage:
                        type: number
                      totalTimeLogged:
                        type: number
                      totalEstimatedTime:
                        type: number
                      daysRemaining:
                        type: integer
                      velocity:
                        type: number
                        description: Tasks completed per day
                      burndownData:
                        type: array
                        items:
                          type: object
                          properties:
                            date:
                              type: string
                              format: date
                            remainingTasks:
                              type: integer
        "501":
          description: Not Implemented

  # ==================== Users ====================
  /users:
    get:
      tags:
        - Users
      summary: Get all users
      description: Retrieve list of all users (Admin only)
      security:
        - CookieAuth: []
      parameters:
        - name: role
          in: query
          schema:
            type: string
            enum: [Admin, Manager, Member]
        - name: department
          in: query
          schema:
            type: string
        - name: isActive
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"

  /users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/400"
        "404":
          $ref: "#/components/responses/404"

    patch:
      tags:
        - Users
      summary: Update user by ID
      description: Update user profile (Admin/Manager only)
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                role:
                  type: string
                  enum: [Admin, Manager, Member]
                department:
                  type: string
                skills:
                  type: array
                  items:
                    type: string
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"

    delete:
      tags:
        - Users
      summary: Delete user
      description: Delete user (Admin/Manager only)
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
        "404":
          description: User not found
  # ==================== Projects ====================
  /projects:
    get:
      tags:
        - Projects
      summary: Get all projects
      security:
        - CookieAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [planned, active, completed, archived]
        - name: client
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Project"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "500":
          $ref: "#/components/responses/500"

    post:
      tags:
        - Projects
      summary: Create new project
      description: Create a new project (Admin/Manager only)
      security:
        - CookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - client
                - startDate
                - endDate
              properties:
                title:
                  type: string
                  example: "Mobile App Development"
                client:
                  type: string
                  example: "Tech Startup Inc"
                description:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                budget:
                  type: number
                status:
                  type: string
                  enum: [planned, active, completed, archived]
                  default: planned
                thumbnail:
                  type: string
      responses:
        "201":
          description: Project created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"

        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"
        "500":
          $ref: "#/components/responses/500"

  /projects/{id}:
    get:
      tags:
        - Projects
      summary: Get project by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"
        "404":
          $ref: "#/components/responses/404"
        "401":
          $ref: "#/components/responses/401"
        "500":
          $ref: "#/components/responses/500"

    patch:
      tags:
        - Projects
      summary: Update project
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                client:
                  type: string
                description:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                budget:
                  type: number
                status:
                  type: string
                  enum: [planned, active, completed, archived]
                thumbnail:
                  type: string
      responses:
        "200":
          description: Project updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"
        "404":
          $ref: "#/components/responses/404"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "500":
          $ref: "#/components/responses/500"

    delete:
      tags:
        - Projects
      summary: Delete project
      description: Delete project (Admin only)
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Success"
        "404":
          $ref: "#/components/responses/404"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "500":
          $ref: "#/components/responses/500"

  /projects/{id}/stats:
    get:
      tags:
        - Projects
      summary: Get project statistics (Not Implemented Yet)
      description: >
        **Note**: This endpoint is defined in routes but not yet implemented.
        It will return project statistics including task counts and completion metrics.
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project statistics retrieved (placeholder)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      totalTasks:
                        type: integer
                      completedTasks:
                        type: integer
                      inProgressTasks:
                        type: integer
                      completionPercentage:
                        type: number
                      totalTimeLogged:
                        type: number
                      estimatedTimeRemaining:
                        type: number
        "501":
          description: Not Implemented

  /projects/{id}/activity:
    get:
      tags:
        - Projects
      summary: Get project activity log (Not Implemented Yet)
      description: >
        **Note**: This endpoint is defined in routes but not yet implemented.
        It will return activity logs for the project.
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Activity log retrieved (placeholder)
        "501":
          description: Not Implemented

  # ==================== Sprints ====================
  /sprints:
    get:
      tags:
        - Sprints
      summary: Get all sprints
      description: Retrieve all sprints across all projects
      security:
        - CookieAuth: []
      responses:
        "200":
          description: Sprints retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Sprints fetched successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Sprint"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"

  /projects/{projectId}/sprints:
    get:
      tags:
        - Sprints
      summary: Get all sprints for a project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprints retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Sprints fetched successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Sprint"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"

    post:
      tags:
        - Sprints
      summary: Create new sprint
      description: Create new sprint for a project
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - startDate
                - endDate
              properties:
                title:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
      responses:
        "201":
          description: Sprint created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Sprint"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"

  /sprints/{id}:
    get:
      tags:
        - Sprints
      summary: Get sprint by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprint retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Sprint"

    patch:
      tags:
        - Sprints
      summary: Update sprint
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
      responses:
        "200":
          description: Sprint updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Sprint"

    delete:
      tags:
        - Sprints
      summary: Delete sprint
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Sprint deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 204
                  message:
                    type: string
                    example: "Sprint deleted successfully"
                  data:
                    nullable: true
                    example: null
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"

  /sprints/{id}/tasks:
    get:
      tags:
        - Tasks
      summary: Get tasks for a sprint
      description: Retrieve all tasks under a specific sprint
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sprint tasks fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Sprint tasks fetched successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Task"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"

    post:
      tags:
        - Tasks
      summary: Create new task under sprint
      description: Create a new task for a specific sprint
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - assignees
                - priority
                - dueDate
              properties:
                title:
                  type: string
                description:
                  type: string
                assignees:
                  type: array
                  items:
                    type: string
                estimate:
                  type: number
                priority:
                  type: string
                  enum: [Low, Medium, High, Critical]
                status:
                  type: string
                  enum: [To Do, In Progress, Review, Done]
                  default: To Do
                dueDate:
                  type: string
                  format: date
                subtasks:
                  type: array
                  items:
                    type: object
                    properties:
                      title:
                        type: string
                      completed:
                        type: boolean
      responses:
        "201":
          description: Task created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"

  # ==================== Tasks ====================
  /tasks:
    get:
      tags:
        - Tasks
      summary: Get all tasks with filters
      description: Retrieve all tasks with optional filtering
      security:
        - CookieAuth: []
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
        - name: sprintId
          in: query
          schema:
            type: string
        - name: assignee
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [To Do, In Progress, Review, Done]
        - name: priority
          in: query
          schema:
            type: string
            enum: [Low, Medium, High, Critical]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        "200":
          description: Tasks retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Tasks fetched successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Task"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"

  /tasks/{id}:
    get:
      tags:
        - Tasks
      summary: Get task by ID
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Task retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "404":
          $ref: "#/components/responses/404"

    patch:
      tags:
        - Tasks
      summary: Update task
      description: Update task details
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                assignees:
                  type: array
                  items:
                    type: string
                estimate:
                  type: number
                priority:
                  type: string
                  enum: [Low, Medium, High, Critical]
                status:
                  type: string
                  enum: [To Do, In Progress, Review, Done]
                dueDate:
                  type: string
                  format: date
      responses:
        "200":
          description: Task updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Success"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Task"
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"

    delete:
      tags:
        - Tasks
      summary: Delete task
      security:
        - CookieAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Task deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 204
                  message:
                    type: string
                    example: "Task deleted successfully"
                  data:
                    nullable: true
                    example: null
        "400":
          $ref: "#/components/responses/400"
        "401":
          $ref: "#/components/responses/401"
        "403":
          $ref: "#/components/responses/403"
        "404":
          $ref: "#/components/responses/404"

components:
  securitySchemes:
    CookieAuth:
      type: apiKey
      in: cookie
      name: session_id

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        role:
          type: string
          enum: [Admin, Manager, Member]
          example: "Member"
        department:
          type: string
          example: "Engineering"
        skills:
          type: array
          items:
            type: string
          example: ["JavaScript", "React", "Node.js"]
        status:
          type: string
          enum: [Active, Inactive, Blocked]
          example: "Active"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Project:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        title:
          type: string
          example: "E-Commerce Platform"
        client:
          type: string
          example: "Acme Corporation"
        description:
          type: string
          example: "Building a modern e-commerce platform with microservices"
        startDate:
          type: string
          format: date
          example: "2025-01-01"
        endDate:
          type: string
          format: date
          example: "2025-06-30"
        budget:
          type: number
          example: 50000
        status:
          type: string
          enum: [planned, active, completed, archived]
          example: "active"
        thumbnail:
          type: string
          example: "https://example.com/images/project-thumb.jpg"
        createdBy:
          type: string
          example: "507f1f77bcf86cd799439011"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Sprint:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        title:
          type: string
          example: "Sprint 1 - Foundation"
        sprintNumber:
          type: integer
          example: 1
        startDate:
          type: string
          format: date
          example: "2025-01-01"
        endDate:
          type: string
          format: date
          example: "2025-01-14"
        projectId:
          type: string
          example: "507f1f77bcf86cd799439011"
        order:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Task:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        title:
          type: string
          example: "Implement user authentication"
        description:
          type: string
          example: "Set up JWT-based authentication with refresh tokens"
        assignees:
          type: array
          items:
            type: string
          example: ["507f1f77bcf86cd799439011"]
        estimate:
          type: number
          example: 8
        priority:
          type: string
          enum: [Low, Medium, High, Critical]
          example: "High"
        status:
          type: string
          enum: [To Do, In Progress, Review, Done]
          example: "In Progress"
        dueDate:
          type: string
          format: date
          example: "2025-01-10"
        attachments:
          type: array
          items:
            $ref: "#/components/schemas/Attachment"
        subtasks:
          type: array
          items:
            $ref: "#/components/schemas/Subtask"
        sprintId:
          type: string
          example: "507f1f77bcf86cd799439011"
        projectId:
          type: string
          example: "507f1f77bcf86cd799439011"
        timeLogged:
          type: number
          example: 5.5
        createdBy:
          type: string
          example: "507f1f77bcf86cd799439011"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Attachment:
      type: object
      properties:
        filename:
          type: string
          example: "design-mockup.pdf"
        url:
          type: string
          example: "https://storage.example.com/files/design-mockup.pdf"
        uploadedBy:
          type: string
          example: "507f1f77bcf86cd799439011"
        uploadedAt:
          type: string
          format: date-time

    Subtask:
      type: object
      properties:
        title:
          type: string
          example: "Set up JWT library"
        completed:
          type: boolean
          example: false

    Comment:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        content:
          type: string
          example: "I've completed the initial setup. Ready for review."
        taskId:
          type: string
          example: "507f1f77bcf86cd799439011"
        userId:
          type: string
          example: "507f1f77bcf86cd799439011"
        parentCommentId:
          type: string
          nullable: true
          example: null
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ActivityLog:
      type: object
      properties:
        _id:
          type: string
        taskId:
          type: string
        userId:
          type: string
        action:
          type: string
          example: "status_changed"
        details:
          type: object
          example: { "from": "To Do", "to": "In Progress" }
        timestamp:
          type: string
          format: date-time

    Success:
      type: object
      properties:
        code:
          type: integer
          example: 200
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"
        links:
          type: object
          properties:
            self:
              type: string
              example: "/api/v1/resource"

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 10
        total:
          type: integer
          example: 100

  responses:
    400:
      description: Bad request
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 400
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Error happened"
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "VALIDATION_ERROR"
                  message:
                    type: string
                    example: "Invalid input data"
                  details:
                    type: object

    401:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 401
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Unauthorized"
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: "number"
                  message:
                    type: string
                    example: "Unauthorized"
                  details:
                    type: object

    403:
      description: Forbidden
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 403
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Forbidden"
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 403
                  message:
                    type: string
                    example: "Forbidden"
                  details:
                    type: object

    404:
      description: Not found
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 404
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Resource Not found"
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 404
                  message:
                    type: string
                    example: "Requested resource not found"
                  details:
                    type: object

    500:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: integer
                example: 500
              success:
                type: boolean
                example: false
              message:
                type: string
                example: "Internal server error"
              error:
                type: object
                properties:
                  code:
                    type: integer
                    example: 500
                  message:
                    type: string
                    example: "Internal server error"
                  details:
                    type: object
